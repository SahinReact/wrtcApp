{"ast":null,"code":"var _jsxFileName = \"/home/nav150/Documents/React Project/webrtc-video-chat/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useState } from 'react';\nimport { db } from './firebase';\nimport { collection, doc, setDoc, getDoc, onSnapshot, addDoc } from 'firebase/firestore';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst servers = {\n  iceServers: [{\n    urls: 'stun:stun.l.google.com:19302'\n  }]\n};\nfunction App() {\n  _s();\n  const localRef = useRef();\n  const remoteRef = useRef();\n  const pc = useRef(new RTCPeerConnection(servers));\n  const [roomId, setRoomId] = useState('');\n  const createRoom = async () => {\n    const roomRef = await addDoc(collection(db, 'rooms'), {});\n    setRoomId(roomRef.id);\n    pc.current.onicecandidate = async event => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'callerCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: false,\n      audio: true\n    });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n    const offer = await pc.current.createOffer();\n    await pc.current.setLocalDescription(offer);\n    await setDoc(roomRef, {\n      offer\n    });\n    onSnapshot(roomRef, async snapshot => {\n      const data = snapshot.data();\n      if (data !== null && data !== void 0 && data.answer && !pc.current.currentRemoteDescription) {\n        const answerDesc = new RTCSessionDescription(data.answer);\n        await pc.current.setRemoteDescription(answerDesc);\n      }\n    });\n    pc.current.ontrack = event => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n  const joinRoom = async () => {\n    const roomRef = doc(db, 'rooms', roomId);\n    const roomSnap = await getDoc(roomRef);\n    const roomData = roomSnap.data();\n    pc.current.onicecandidate = async event => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'calleeCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n    await pc.current.setRemoteDescription(new RTCSessionDescription(roomData.offer));\n    const answer = await pc.current.createAnswer();\n    await pc.current.setLocalDescription(answer);\n    await setDoc(roomRef, {\n      ...roomData,\n      answer\n    });\n    pc.current.ontrack = event => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"WebRTC with Firebase\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: localRef,\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        width: \"300\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: remoteRef,\n        autoPlay: true,\n        playsInline: true,\n        width: \"300\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: createRoom,\n        children: \"Create Room\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        value: roomId,\n        onChange: e => setRoomId(e.target.value),\n        placeholder: \"Room ID\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: joinRoom,\n        children: \"Join Room\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"Lb53fMgE6FjuRnarfK7DFNa41n8=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useRef","useState","db","collection","doc","setDoc","getDoc","onSnapshot","addDoc","jsxDEV","_jsxDEV","servers","iceServers","urls","App","_s","localRef","remoteRef","pc","RTCPeerConnection","roomId","setRoomId","createRoom","roomRef","id","current","onicecandidate","event","candidate","toJSON","stream","navigator","mediaDevices","getUserMedia","video","audio","srcObject","getTracks","forEach","track","addTrack","offer","createOffer","setLocalDescription","snapshot","data","answer","currentRemoteDescription","answerDesc","RTCSessionDescription","setRemoteDescription","ontrack","streams","joinRoom","roomSnap","roomData","createAnswer","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","muted","width","onClick","value","onChange","e","target","placeholder","_c","$RefreshReg$"],"sources":["/home/nav150/Documents/React Project/webrtc-video-chat/src/App.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { db } from './firebase';\nimport {\n  collection,\n  doc,\n  setDoc,\n  getDoc,\n  onSnapshot,\n  addDoc,\n} from 'firebase/firestore';\n\nconst servers = {\n  iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\n};\n\nfunction App() {\n  const localRef = useRef();\n  const remoteRef = useRef();\n  const pc = useRef(new RTCPeerConnection(servers));\n  const [roomId, setRoomId] = useState('');\n\n  const createRoom = async () => {\n    const roomRef = await addDoc(collection(db, 'rooms'), {});\n    setRoomId(roomRef.id);\n\n    pc.current.onicecandidate = async (event) => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'callerCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n\n    const stream = await navigator.mediaDevices.getUserMedia({ video: false, audio: true });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n\n    const offer = await pc.current.createOffer();\n    await pc.current.setLocalDescription(offer);\n\n    await setDoc(roomRef, { offer });\n\n    onSnapshot(roomRef, async (snapshot) => {\n      const data = snapshot.data();\n      if (data?.answer && !pc.current.currentRemoteDescription) {\n        const answerDesc = new RTCSessionDescription(data.answer);\n        await pc.current.setRemoteDescription(answerDesc);\n      }\n    });\n\n    pc.current.ontrack = (event) => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n\n  const joinRoom = async () => {\n    const roomRef = doc(db, 'rooms', roomId);\n    const roomSnap = await getDoc(roomRef);\n    const roomData = roomSnap.data();\n\n    pc.current.onicecandidate = async (event) => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'calleeCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n\n    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n\n    await pc.current.setRemoteDescription(new RTCSessionDescription(roomData.offer));\n\n    const answer = await pc.current.createAnswer();\n    await pc.current.setLocalDescription(answer);\n    await setDoc(roomRef, { ...roomData, answer });\n\n    pc.current.ontrack = (event) => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n\n  return (\n    <div>\n      <h2>WebRTC with Firebase</h2>\n      <div>\n        <video ref={localRef} autoPlay playsInline muted width=\"300\" />\n        <video ref={remoteRef} autoPlay playsInline width=\"300\" />\n      </div>\n\n      <div>\n        <button onClick={createRoom}>Create Room</button>\n        <input\n          value={roomId}\n          onChange={(e) => setRoomId(e.target.value)}\n          placeholder=\"Room ID\"\n        />\n        <button onClick={joinRoom}>Join Room</button>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}