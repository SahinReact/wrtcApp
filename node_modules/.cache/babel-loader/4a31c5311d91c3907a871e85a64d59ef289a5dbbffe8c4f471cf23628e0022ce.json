{"ast":null,"code":"import _objectSpread from\"/home/nav150/Documents/React Project/webrtc-video-chat/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useRef,useState}from'react';import{db}from'./firebase';import{collection,doc,setDoc,getDoc,onSnapshot,addDoc}from'firebase/firestore';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const servers={iceServers:[{urls:'stun:stun.l.google.com:19302'}]};function App(){const localRef=useRef();const remoteRef=useRef();const pc=useRef(new RTCPeerConnection(servers));const[roomId,setRoomId]=useState('');const createRoom=async()=>{const roomRef=await addDoc(collection(db,'rooms'),{});setRoomId(roomRef.id);pc.current.onicecandidate=async event=>{if(event.candidate){await setDoc(doc(roomRef,'callerCandidates',event.candidate.candidate),event.candidate.toJSON());}};const stream=await navigator.mediaDevices.getUserMedia({video:false,audio:true});localRef.current.srcObject=stream;stream.getTracks().forEach(track=>pc.current.addTrack(track,stream));const offer=await pc.current.createOffer();await pc.current.setLocalDescription(offer);await setDoc(roomRef,{offer});onSnapshot(roomRef,async snapshot=>{const data=snapshot.data();if(data!==null&&data!==void 0&&data.answer&&!pc.current.currentRemoteDescription){const answerDesc=new RTCSessionDescription(data.answer);await pc.current.setRemoteDescription(answerDesc);}});pc.current.ontrack=event=>{remoteRef.current.srcObject=event.streams[0];};};const joinRoom=async()=>{const roomRef=doc(db,'rooms',roomId);const roomSnap=await getDoc(roomRef);const roomData=roomSnap.data();pc.current.onicecandidate=async event=>{if(event.candidate){await setDoc(doc(roomRef,'calleeCandidates',event.candidate.candidate),event.candidate.toJSON());}};const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});localRef.current.srcObject=stream;stream.getTracks().forEach(track=>pc.current.addTrack(track,stream));await pc.current.setRemoteDescription(new RTCSessionDescription(roomData.offer));const answer=await pc.current.createAnswer();await pc.current.setLocalDescription(answer);await setDoc(roomRef,_objectSpread(_objectSpread({},roomData),{},{answer}));pc.current.ontrack=event=>{remoteRef.current.srcObject=event.streams[0];};};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"WebRTC with Firebase\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"video\",{ref:localRef,autoPlay:true,playsInline:true,muted:true,width:\"300\"}),/*#__PURE__*/_jsx(\"video\",{ref:remoteRef,autoPlay:true,playsInline:true,width:\"300\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:createRoom,children:\"Create Room\"}),/*#__PURE__*/_jsx(\"input\",{value:roomId,onChange:e=>setRoomId(e.target.value),placeholder:\"Room ID\"}),/*#__PURE__*/_jsx(\"button\",{onClick:joinRoom,children:\"Join Room\"})]})]});}export default App;","map":{"version":3,"names":["React","useRef","useState","db","collection","doc","setDoc","getDoc","onSnapshot","addDoc","jsx","_jsx","jsxs","_jsxs","servers","iceServers","urls","App","localRef","remoteRef","pc","RTCPeerConnection","roomId","setRoomId","createRoom","roomRef","id","current","onicecandidate","event","candidate","toJSON","stream","navigator","mediaDevices","getUserMedia","video","audio","srcObject","getTracks","forEach","track","addTrack","offer","createOffer","setLocalDescription","snapshot","data","answer","currentRemoteDescription","answerDesc","RTCSessionDescription","setRemoteDescription","ontrack","streams","joinRoom","roomSnap","roomData","createAnswer","_objectSpread","children","ref","autoPlay","playsInline","muted","width","onClick","value","onChange","e","target","placeholder"],"sources":["/home/nav150/Documents/React Project/webrtc-video-chat/src/App.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { db } from './firebase';\nimport {\n  collection,\n  doc,\n  setDoc,\n  getDoc,\n  onSnapshot,\n  addDoc,\n} from 'firebase/firestore';\n\nconst servers = {\n  iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\n};\n\nfunction App() {\n  const localRef = useRef();\n  const remoteRef = useRef();\n  const pc = useRef(new RTCPeerConnection(servers));\n  const [roomId, setRoomId] = useState('');\n\n  const createRoom = async () => {\n    const roomRef = await addDoc(collection(db, 'rooms'), {});\n    setRoomId(roomRef.id);\n\n    pc.current.onicecandidate = async (event) => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'callerCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n\n    const stream = await navigator.mediaDevices.getUserMedia({ video: false, audio: true });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n\n    const offer = await pc.current.createOffer();\n    await pc.current.setLocalDescription(offer);\n\n    await setDoc(roomRef, { offer });\n\n    onSnapshot(roomRef, async (snapshot) => {\n      const data = snapshot.data();\n      if (data?.answer && !pc.current.currentRemoteDescription) {\n        const answerDesc = new RTCSessionDescription(data.answer);\n        await pc.current.setRemoteDescription(answerDesc);\n      }\n    });\n\n    pc.current.ontrack = (event) => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n\n  const joinRoom = async () => {\n    const roomRef = doc(db, 'rooms', roomId);\n    const roomSnap = await getDoc(roomRef);\n    const roomData = roomSnap.data();\n\n    pc.current.onicecandidate = async (event) => {\n      if (event.candidate) {\n        await setDoc(doc(roomRef, 'calleeCandidates', event.candidate.candidate), event.candidate.toJSON());\n      }\n    };\n\n    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n    localRef.current.srcObject = stream;\n    stream.getTracks().forEach(track => pc.current.addTrack(track, stream));\n\n    await pc.current.setRemoteDescription(new RTCSessionDescription(roomData.offer));\n\n    const answer = await pc.current.createAnswer();\n    await pc.current.setLocalDescription(answer);\n    await setDoc(roomRef, { ...roomData, answer });\n\n    pc.current.ontrack = (event) => {\n      remoteRef.current.srcObject = event.streams[0];\n    };\n  };\n\n  return (\n    <div>\n      <h2>WebRTC with Firebase</h2>\n      <div>\n        <video ref={localRef} autoPlay playsInline muted width=\"300\" />\n        <video ref={remoteRef} autoPlay playsInline width=\"300\" />\n      </div>\n\n      <div>\n        <button onClick={createRoom}>Create Room</button>\n        <input\n          value={roomId}\n          onChange={(e) => setRoomId(e.target.value)}\n          placeholder=\"Room ID\"\n        />\n        <button onClick={joinRoom}>Join Room</button>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}